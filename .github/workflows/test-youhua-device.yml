name: "测试友华WR1200JS设备名称"

on: workflow_dispatch

jobs:
  test-device:
    runs-on: ubuntu-22.04
    
    steps:
    - name: 1. 显示当前配置
      uses: actions/checkout@v4
    
    - name: 2. 检查配置文件
      run: |
        echo "检查友华WR1200JS配置文件..."
        echo ""
        
        if [ -f "configs/youhua/base.config" ]; then
          echo "base.config中的设备配置:"
          grep "CONFIG_TARGET.*DEVICE" configs/youhua/base.config || echo "未找到设备配置"
        else
          echo "错误: configs/youhua/base.config 文件不存在"
        fi
        
        echo ""
        
        if [ -f "configs/youhua/plus.config" ]; then
          echo "plus.config中的设备配置:"
          grep "CONFIG_TARGET.*DEVICE" configs/youhua/plus.config || echo "未找到设备配置"
        else
          echo "错误: configs/youhua/plus.config 文件不存在"
        fi
    
    - name: 3. 创建测试配置
      run: |
        echo "创建测试配置文件..."
        echo ""
        
        # 创建目录（如果不存在）
        mkdir -p configs-test
        
        # 测试配置1: youhua_wr1200js
        echo "测试配置1: youhua_wr1200js"
        echo "CONFIG_TARGET_ramips=y" > configs-test/test1.config
        echo "CONFIG_TARGET_ramips_mt7621=y" >> configs-test/test1.config
        echo "CONFIG_TARGET_ramips_mt7621_DEVICE_youhua_wr1200js=y" >> configs-test/test1.config
        echo "CONFIG_TARGET_ROOTFS_SQUASHFS=y" >> configs-test/test1.config
        
        # 测试配置2: wr1200js  
        echo "测试配置2: wr1200js"
        echo "CONFIG_TARGET_ramips=y" > configs-test/test2.config
        echo "CONFIG_TARGET_ramips_mt7621=y" >> configs-test/test2.config
        echo "CONFIG_TARGET_ramips_mt7621_DEVICE_wr1200js=y" >> configs-test/test2.config
        echo "CONFIG_TARGET_ROOTFS_SQUASHFS=y" >> configs-test/test2.config
        
        echo "✅ 测试配置文件已创建"
        ls -la configs-test/
    
    - name: 4. 显示测试配置
      run: |
        echo "测试配置文件内容:"
        echo ""
        
        for file in configs-test/*.config; do
          echo "=== $(basename $file) ==="
          cat "$file"
          echo ""
        done
    
    - name: 5. 提供修复建议
      run: |
        echo "=== 修复建议 ==="
        echo ""
        echo "如果设备名称错误，请按以下步骤修复:"
        echo ""
        echo "1. 打开配置文件:"
        echo "   configs/youhua/base.config"
        echo ""
        echo "2. 查找并修改设备名称行，应类似:"
        echo "   CONFIG_TARGET_ramips_mt7621_DEVICE_youhua_wr1200js=y"
        echo ""
        echo "3. 重新生成配置文件:"
        echo "   cat configs/youhua/base.config configs/youhua/plus.diff > configs/youhua/plus.config"
        echo ""
        echo "4. 重新运行构建工作流"
    
    - name: 6. 清理
      run: |
        echo "清理测试文件..."
        rm -rf configs-test
        echo "完成"
